<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layouts/layout1}">

	<title>멍냥실종 : 글쓰기</title>

	<!-- CSS  -->
	<th:block layout:fragment="css">
		<link rel="stylesheet" type="text/css" th:href="@{/css/missingForm.css}">
	</th:block>

	<!-- script  -->
	<th:block layout:fragment="script">
		<script type="text/javascript" th:src="@{/js/missingForm.js}"></script>
		<script th:inline="javascript">
			$(document).ready(function(){
                var errorMessage = /*[[${errorMessage}]]*/ "";
                if(errorMessage != null){
                    alert(errorMessage);
                }
                bindDomEvent();

                let missing_default_content = '<h3>기본 정보</h3><p>마지막 목격장소 : </p><p>마지막 목격날짜  : </p><p>보호자 연락처 : </p><p>특징 : </p>';
                let targetElement = document.getElementById('defaultContent');
                targetElement.innerHTML = missing_default_content;

            });

            //사용자가 이미지파일을 선택하면 이미지인지 확인하고 레이블에 이름 표시
            function bindDomEvent(){
                $(".custom-file-input").on("change", function() {
                    var fileName = $(this).val().split("\\").pop();
                    var fileExt = fileName.substring(fileName.lastIndexOf(".")+1);
                    fileExt = fileExt.toLowerCase();

                    if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
                        alert("이미지 파일만 등록이 가능합니다.");
                        return;
                    }

                    $(this).siblings(".custom-file-label").html(fileName);
                });
            }

		</script>
	</th:block>

	<!-- content  -->
	<div layout:fragment="content">
		<div id="container">
			<div id="container1">
				<form role = "form" method="post" enctype="multipart/form-data" th:object = "${missingFormDTO}" id="form1">
					<div class="form-group">
						<select th:field="*{MissingKind}" class="custom-select">
							<option value="DISAPPEAR">실종</option>
							<option value="WITNESS">목격</option>
							<option value="PROTECT">보호</option>
						</select>
					</div>
					<div class="input_title">
						<input id="title1" type="text" th:field="*{missingTitle}" class="form-control" placeholder="제목">
					</div>
					<!-- 여기 수정해야함 -->
						<input id="img1" type="text" placeholder="프로필 이미지 주소">
						<input id="title2" type="text" placeholder="닉네임">
						<input id="img2" type="text" placeholder="이미지 주소">

					<div>
						<p id = "defaultContent"></p>
						<textarea id="content1" class="form-control" aria-label="With textarea" th:field="*{missingContent}" placeholder="내용을 입력해 주세요.">
						</textarea>
					</div>
					<p th:if="${#fields.hasErrors('missingContent')}" th:errors="*{missingContent}" class="fieldError">내용을 입력해주세요</p>

					<div th:if="${#lists.isEmpty(missingFormDTO.missingImgDTOList)}">
						<div class="form-group" th:each="num: ${#numbers.sequence(1,5)}">
							<div class="custom-file img-div">
								<input type="file" class="custom-file-input" name="missingImgFile">
								<label class="custom-file-label" th:text="반려동물사진 + ${num}"></label>
							</div>
						</div>
					</div>

					<div th:if = "${not #lists.isEmpty(missingFormDTO.missingImgDTOList)}">
						<div class="form-group" th:each="missingImgDTO, status: ${missingFormDTO.missingImgDTOList}">
							<div class="custom-file img-div">
								<input type="file" class="custom-file-input" name="missingImgFile">
								<input type="hidden" name="missingImgIds" th:value="${missingImgDTO.missingImgId}">
								<label class="custom-file-label" th:text="${not #strings.isEmpty(missingImgDTO.missingOriImgName)} ? ${missingImgDTO.missingOriImgName} : '반려동물사진' + ${status.index+1}"></label>
							</div>
						</div>
					</div>

					<div th:if="${#strings.isEmpty(missingFormDTO.missingId)}" style="text-align: center">
						<button th:formaction="@{/missing/write}" type="submit" class="btn btn-primary">저장</button>
					</div>
					<div th:unless="${#strings.isEmpty(missingFormDTO.missingId)}" style="text-align: center">
						<button th:formaction="@{'/missing/write' + ${missingFormDTO.missingId} }" type="submit" class="btn btn-primary">수정</button>
					</div>
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

				</form>
			</div>
		</div>
	</div>



</html>